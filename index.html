<!DOCTYPE html>
<html>
  <head>
    <script>
      window.onload = function () {
        var dataPoints1 = [];
        var dataPoints2 = [];
        var dataPoints3 = [];

        var options = {
          title: {
            text: "Smart Frigo monitoring "
          },
          axisX: {
            title: "chart updates every 1 secs"
          },
          axisY: {
            suffix: "C°"
          },
          toolTip: {
            shared: true
          },
          legend: {
            cursor: "pointer",
            verticalAlign: "top",
            fontSize: 22,
            fontColor: "dimGrey",
            itemclick: toggleDataSeries
          },
          data: [
            {
              type: "line",
               xValueType: "dateTime",
               yValueFormatString: "### C°",
              xValueFormatString: "hh:mm:ss TT",
              showInLegend: true,//
              name: "Temperature ",
              dataPoints: dataPoints1
            }
            /*{
              type: "line",
              xValueType: "dateTime",
              yValueFormatString: "###.00",
              showInLegend: true,
              name: "Humidité ",
              dataPoints: dataPoints2
            }, */
          ]
        };

        var chart = $("#chartContainer").CanvasJSChart(options);

        function toggleDataSeries(e) {
          if (
            typeof e.dataSeries.visible === "undefined" ||
            e.dataSeries.visible
          ) {
            e.dataSeries.visible = false;
          } else {
            e.dataSeries.visible = true;
          }
          e.chart.render();
        }

        function updateChart() {
          var urllist = "/get-list";
          
          $.getJSON(urllist, {}).done(function (data) {
            // console.log(data);

            dataPoints1.length = 0 
            data.forEach(function (el) {
               // console.log(el.dt);
             
              //  console.log(dt)
              dataPoints1.push({
                x: Date.parse(el.dt),
                y: parseInt(el.val)
              });
            });

           // options.data[0].legendText = "Temperature  : " + 50 + "C°";
          $("#chartContainer").CanvasJSChart().render();
          });
        }
        // generates first set of dataPoints
        updateChart();
        setInterval(function () {
          updateChart();
        }, 5000);
      };
    </script>
  </head>
  <body>
    <div id="chartContainer" style="height: 300px; width: 100%;"></div>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
  </body>
</html>
